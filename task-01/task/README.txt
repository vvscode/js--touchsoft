Пример работающего кода:

http://jsbin.com/pijere/1/edit?html,js,output

Работающие тесты:

http://output.jsbin.com/rimosof/7