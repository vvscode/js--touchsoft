Пример работающего кода:

http://jsbin.com/pijere/1/edit?html,js,output

Работающие тесты:

http://jsbin.com/tojupax/edit?html,output
