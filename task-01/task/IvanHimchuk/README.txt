Пример работающего кода:

http://output.jsbin.com/rimosof/8

Работающие тесты:

http://output.jsbin.com/rimosof/7