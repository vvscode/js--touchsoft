Пример работающего кода:

http://output.jsbin.com/topiqaw/1


Работающие тесты:

http://output.jsbin.com/rimosof